name: Issue phase bootstrap

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Add initial phase label if missing
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            const phasePrefix = "phase:";
            const hasPhase = (issue.labels || []).some(l => (l.name || "").startsWith(phasePrefix));
            if (hasPhase) return;

            await github.rest.issues.addLabels({
              owner, repo,
              issue_number: issue.number,
              labels: ["phase:idea_explore"]
            });

            await github.rest.issues.createComment({
              owner, repo,
              issue_number: issue.number,
              body: [
                "\ud83d\udecf **Phase initialized:** `phase:idea_explore`",
                "",
                "次の一手（迷わないための運用）",
                "- ChatGPTに\u300c探索プロンプト\u300dを投げて方向性3\u30105\u3011 & NextAction\u30103\u3011を作る",
                "- 返ってきた内容をこのIssueに貼る",
                "- 進めるなら `/approve`",
                "",
                "※フェーズは常に1つ（`phase:*` を付けると既存 `phase:*` は外れます）"
              ].join("\n")
            });
